; PlatformIO Project Configuration File
; 
; 2026 TAG Code Project
; Hardware: ESP32-S3 + ICM-20948 (Accel+Gyro) + BMM350 (Magnetometer) + u-blox NEO-M9N GPS
;
; CRITICAL: Library versions are PINNED to prevent auto-update breakage
; Based on 2026 BASE Code structure with hardware-specific adaptations

[platformio]
default_envs = esp32-s3-devkitc-1

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Serial Monitor Settings
monitor_speed = 921600
monitor_filters = esp32_exception_decoder

; Build Flags
build_flags = 
    -D CORE_DEBUG_LEVEL=0           ; Disable system logs to prevent I2C error flooding crash
    -D ARDUINO_USB_CDC_ON_BOOT=0     ; CRITICAL: Disable USB CDC - use hardware UART
    -D CONFIG_ARDUHAL_LOG_COLORS=1   ; Colored logs
    -D CONFIG_ARDUINO_LOOP_STACK_SIZE=16384  ; 16KB loop stack (calibration needs 12KB+)

; Source Filters
build_src_filter = +<*> -<bmm350_debug_main.cpp>

; Library Dependencies (PINNED VERSIONS)
lib_deps = 
    ; GNSS (NEO-M9N) - SparkFun u-blox GNSS v3 (SAME AS BASE CODE)
    ; WARNING: v3.0.5+ required for ESP32 I2C fix
    sparkfun/SparkFun u-blox GNSS v3 @ ^3.1.3
    
    ; ICM-20948 IMU (Accelerometer + Gyroscope ONLY, AK09916 magnetometer DISABLED)
    ; Uses SparkFun library - proven and simple
    sparkfun/SparkFun 9DoF IMU Breakout - ICM 20948 - Arduino Library @ ^1.3.2
    
    ; NOTE: BMM350 Magnetometer driver will be extracted manually
    ; Bosch core driver files (bmm350.c/h, bmm350_defs.h) from DFRobot_BMM350 library
    ; Custom wrapper will be created to match IMUManager architecture
    
    ; System Libraries
    ; NVS (Non-Volatile Storage) for settings - built-in ESP32
    ; Watchdog - built-in esp_task_wdt
    ; ESP-NOW - built-in esp_now

; Advanced Options
board_build.partitions = default.csv
board_build.filesystem = littlefs

; Upload Settings
upload_speed = 921600

; NOTES:
; - BMM350 I2C address: 0x14 (default - to be verified when hardware integrated)
; - ICM-20948 I2C address: 0x68 (standard)
; - GPS I2C address: 0x42 (M5Stack GNSS Module compatible)
; - No barometer library (TAG hardware doesn't include BMP280)

[env:bmm350_debug]
extends = env:esp32-s3-devkitc-1
build_src_filter = +<bmm350_debug_main.cpp> +<sensors/bmm350.c> -<main.cpp>
build_flags = 
    -D CORE_DEBUG_LEVEL=5
    -D ARDUINO_USB_CDC_ON_BOOT=0
